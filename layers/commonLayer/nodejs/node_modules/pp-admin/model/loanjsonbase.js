const { Q, q } = require('pp-mysql/client').shorthands();
const { FIELD, Model } = require('./model');
const { LoanBase } = require('./loanbase');

/// Loan JSON table base data
class LoanJSONBase extends Model {

    static table = LoanBase.table;///< DB table
    static jsontable = 'jsontable';///< Alias for JSON_TABLE
    static JSONORD = 'i';///< Ordinality of JSON table rows
    static DBID = '_rowid';///< DB field of loan ID

    /// API field => DB field
    static api2db = {
        [this.ID]: {// Integer ID of loan transaction
            [FIELD.DBFIELD]: [this.DBID, [ this.jsontable, this.JSONORD ]],
            [FIELD.REQ]: ['loan_id', this.JSONORD],
        },
        'loan_id': {// Loan integer ID
            [FIELD.DBFIELD]: this.DBID,
            [FIELD.READONLY]: true,
        },
        [this.JSONORD]: {
            [FIELD.SELECT]: `${Q(this.jsontable)}.${Q(this.JSONORD)}`,
        },
        'loan_sid': {// Loan String ID
            [FIELD.DBFIELD]: 'fullID',
            [FIELD.READONLY]: true,
        },
    };
}

module.exports = { LoanJSONBase };
