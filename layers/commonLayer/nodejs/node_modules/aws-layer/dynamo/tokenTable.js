const AWS = require('aws-sdk');
const dynamo = new AWS.DynamoDB.DocumentClient(require('./cfg.js'));

const TOKEN_TABLE = process.env.tokenTable

// DynamoDB: Token table
exports.postToken = async (recordsObject) => {
  const { user, expiration, token, type } = recordsObject
  await dynamo.put({
    TableName: TOKEN_TABLE,
    Item: {
      user: Number(user),
      expiration,
      type,
      token
    }
  }).promise()
}

exports.getTokens = async  (user, unixS) => {
  const tokens = await dynamo.query({
    TableName: TOKEN_TABLE,
    KeyConditionExpression: '#user = :user and expiration > :exp',
    ExpressionAttributeValues: {
      ':user': Number(user),
      ':exp': Number(unixS)
    },
    ExpressionAttributeNames: {
      '#user': 'user'
    },
    ScanIndexForward: false
  }).promise()
  return tokens.Items
}
